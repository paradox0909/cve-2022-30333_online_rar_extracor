FROM php:7.1-apache

RUN apt-get update
RUN apt-get upgrade -y

COPY ./deploy/src /var/www/html/
RUN chmod 777 /var/www/html/upload/
COPY ./deploy/run-lamp.sh /usr/sbin/

RUN chmod +x /usr/sbin/run-lamp.sh

# FLAG
COPY deploy/flag.c /flag.c
RUN apt install -y gcc \
    && gcc /flag.c -o /flag \
    && chmod 111 /flag && rm /flag.c

EXPOSE 80

CMD ["/usr/sbin/run-lamp.sh"]